<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<script src="steps.js"></script>
	<link rel="stylesheet" type="text/css" href="style.css">
	<title>Replayer</title>
</head>
<body>
	<div id="screen" style="background-color: black; color: white; min-height: 60vh;"></div>
	<div id="buttons" style="text-align: center;">
		<span id="current-step">(Kein Replay</span><span id="nb-steps"> geladen)</span>
		<button onclick="pre();">&#x25c0;</button>
		<button onclick="playPause(this);">&#x23ef;</button>
		<button onclick="nxt();">&#x25b6;</button>
	</div>
	<label for="file-to-load">Replay-Datei (JSON) hier ausw&auml;hlen:</label>
	<input type="file" id="file-to-load"/>
	<br/>
	<label for="load-file-button">Dann hier zum Laden clicken:</label>
	<button onclick="loadFile();" id="load-file-button">Datei laden</button>
</body>
<script>
	var steps = [];
	var inverts = [];
	var state = null;
	var playing = false;
	var playLock = undefined;
	var currentStep = 0;
	var stepCountDom = document.getElementById('step-count');
	const nxt = () => {
		const step = steps.shift();
		if(!step) return false;
		currentStep++; document.getElementById('current-step').textContent = currentStep;
		inverts.unshift(invert(step, state, false));
		state = apply(step, false);
		return true;
	}
	const pre = () => {
		const inver = inverts.shift();
		if(!inver) return false;
		currentStep--; document.getElementById('current-step').textContent = currentStep;
		steps.unshift(invert(inver, state, true));
		state = apply(inver, true);
		return true;
	}
	const playLoop = (playBtn) => { const ret = nxt(); if(!ret){ pause(playBtn); } }
	const play = (playBtn) => {
		if(nxt()){
			playing = true;
			playBtn.textContent = '\u23f8';
			playLock = setInterval(playLoop, 1200, playBtn);
		}
	}
	const pause = (playBtn) => {
		playing = false;
		playBtn.textContent = '\u23ef';
		clearInterval(playLock);
		playLock = undefined;
	}
	const playPause = (playBtn) => {
		if(!playing) play(playBtn);
		else pause(playBtn);
	}

	const loadFile = () => {
		const fileInput = document.getElementById('file-to-load');
		let file = fileInput.files[0];
		console.log(file);
		let reader = new FileReader();
		reader.onload = () => {
			init(reader.result);
			currentStep = 0;
			document.getElementById('nb-steps').textContent = '/' + steps.length; document.getElementById('current-step').textContent = '0';
		}
		reader.onerror = () => { console.log('ERROR: could not load file because...\n' + reader.error); }
		reader.readAsText(file);
	}
</script>
</html>
