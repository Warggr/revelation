<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Revelation Server</title>
</head>
<body>
	<h1>Welcome</h1>
	<div id="status"></div>
	<button onclick="reload()">Refresh</button>
	<button onclick="createNewRoom()">New Room</button>
	<script type="text/javascript">
		function load(statusDiv,data){
			if(data.length == 0) statusDiv.innerText = '(no rooms)';
			else statusDiv.innerText = '';
			for(let room of data){
				console.log(room);
				let roomDOM = document.createElement('div');
				let myh3 = document.createElement('h3'); myh3.textContent = 'Room ' + room.id; roomDOM.appendChild(myh3);
				let watch = document.createElement('a'); watch.href = `/files/player.html?g=${room.id}`; watch.textContent = 'Watch'; roomDOM.appendChild(watch);
				let myp = document.createElement('p'); myp.textContent = room.spectators + ' spectators'; roomDOM.appendChild(myp);
				let agentsList = document.createElement('div');
				for(let agentId in room.agents){
					let agentDOM = document.createElement('span');
					if(room.agents[agentId] == "free") agentDOM.innerHTML = `<a href="/files/player.html?g=${room.id}&a=${agentId}">Join</a>`;
					else agentDOM.innerHTML = '<p>' + room.agents[agentId] + '</p>';
					agentsList.appendChild(agentDOM);
				}
				roomDOM.appendChild(agentsList);
				statusDiv.appendChild(roomDOM);
			}
		}
		function reload(){
			const statusDiv = document.getElementById('status');
			statusDiv.textContent = 'Loading...';
			const req = new XMLHttpRequest();
			req.onreadystatechange = () => { if(req.readyState===XMLHttpRequest.DONE){ if(req.status<300) load(statusDiv,JSON.parse(req.responseText)); else console.warn("ERROR");}};
			req.open('GET', '/room/'); req.send();
		}
		reload();
		function createNewRoom(){
			const req = new XMLHttpRequest();
			req.onreadystatechange = () => { if(req.readyState===XMLHttpRequest.DONE){ if(req.status<300) reload(); else console.warn("ERROR");}};
			req.open('POST', '/room'); req.send();
		}
	</script>
</body>
</html>
